<section class="dashboard-main-grid">
    <div class="filters-bar">
        <div class="main-filter-group">

            <!-- Filtro de criptomoneda -->
            <mat-form-field appearance="fill" class="crypto-field" aria-label="Selecciona criptomoneda">
                <mat-label>Criptomoneda</mat-label>
                <mat-select [(ngModel)]="selectedCrypto" (selectionChange)="onSelectCrypto()"
                    [compareWith]="compareCrypto">
                    <mat-option *ngFor="let c of cryptos" [value]="c">
                        <span class="custom-avatar"><img [src]="c.image" [alt]="c.name" /></span>
                        {{ c.name }}
                    </mat-option>
                </mat-select>
            </mat-form-field>

            <!-- Botón para mostrar/ocultar filtros secundarios, SOLO en móvil -->
            <button mat-stroked-button 
                    class="toggle-filters-btn" 
                    *ngIf="isMobile && selectedCrypto" 
                    (click)="showFilters = !showFilters"
                    aria-label="Alternar filtros avanzados">
                {{ showFilters ? 'Ocultar filtros' : 'Más filtros' }}
            </button>
        </div>


        <!-- Filtros secundarios colapsables -->
        <div class="secondary-filters" [class.hidden]="isMobile && !showFilters">
            <!-- Filtro de tipo de gráfico -->
            <mat-form-field appearance="fill" class="chart-type-field" aria-label="Selecciona tipo de gráfico"
                *ngIf="selectedCrypto">
                <mat-label>Tipo de gráfico</mat-label>
                <mat-select [(ngModel)]="selectedChartType">
                    <mat-option value="line">Línea</mat-option>
                    <mat-option value="bar">Barras</mat-option>
                </mat-select>
            </mat-form-field>
            <!-- Filtro de moneda -->
            <mat-form-field appearance="fill" class="currency-field" aria-label="Selecciona tipo de moneda"
                *ngIf="selectedCrypto">
                <mat-label>Moneda</mat-label>
                <mat-select [(ngModel)]="selectedCurrency">
                    <mat-option value="usd">USD</mat-option>
                    <mat-option value="eur">EUR</mat-option>
                </mat-select>
            </mat-form-field>
            <!-- Rango de días -->
            <mat-form-field appearance="fill" class="range-field" aria-label="Selecciona rango de días"
                *ngIf="selectedCrypto">
                <mat-label>Rango de días</mat-label>
                <mat-select [(ngModel)]="selectedDays">
                    <mat-option [value]="7">7 días</mat-option>
                    <mat-option [value]="14">14 días</mat-option>
                    <mat-option [value]="30">30 días</mat-option>
                    <mat-option [value]="90">90 días</mat-option>
                    <mat-option [value]="365">365 días</mat-option>
                </mat-select>
            </mat-form-field>
        </div>
    </div>
    @if (selectedCrypto) {
    <div class="crypto-header-center-row">
        <mat-card class="crypto-header-card">
            <div class="crypto-header">
                <span class="crypto-logo">
                    <img [src]="selectedCrypto.image" alt="{{selectedCrypto.name}}" />
                </span>
                <div class="crypto-header-info">
                    <div class="crypto-name">{{ selectedCrypto.name }}</div>
                    <div class="crypto-symbol">{{ selectedCrypto.symbol | uppercase }}</div>
                    <div class="current-price">
                        <span class="currency-symbol">{{ selectedCurrency == 'usd' ? '$' : '€' }}</span>
                        <span class="currency-amount">{{ selectedCrypto.current_price | number:'1.2-2' }}</span>
                        <span class="currency-code">{{ selectedCurrency | uppercase }}</span>
                    </div>
                </div>
            </div>
        </mat-card>
    </div>
    <main class="crypto-chart-panel" aria-label="Panel principal de dashboard">
        <app-crypto-chart-component [coinId]="selectedCrypto.id" [coinName]="selectedCrypto.name" [days]="selectedDays"
            [chartType]="selectedChartType" [currency]="selectedCurrency">
        </app-crypto-chart-component>
    </main>
    }
    @else {
    <div class="center-content">
        <h2>Selecciona una criptomoneda para ver sus detalles</h2>
    </div>
    }
</section>